<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script src="../../common/vue/vue.js"></script>
    <script src="../../common/axios/axios.min.js"></script>
    <script src="../../common/jquery/jquery-3.0.0.min.js"></script>
    <link rel="stylesheet" href="../../common/element/index.css">
    <script src="../../common/element/index.js"></script>
    <script src="../../js/error.js"></script>
</head>
<body>
    <div id="app">
        <template>
            <div>
                <table>
                    <tr>
                        <td>
                            <div class="block">
                                <el-date-picker v-model="Date"
                                                type="datetimerange"
                                                range-separator="至"
                                                start-placeholder="开始时间"
                                                end-placeholder="结束时间"
                                                align="right">
                                </el-date-picker>
                            </div>
                        </td>
                        <td>
                            <el-radio v-model="Status" label="1">启用</el-radio>
                            <el-radio v-model="Status" label="2">禁用</el-radio>
                        </td>
                    </tr>
                    <tr>
                    </tr>
                </table>
            </div>
            <div>
                <el-table :data="tableData"
                          style="width: 100%">
                    <el-table-column prop="account"
                                     label="账号"
                                     width="100px">
                    </el-table-column>
                    <el-table-column prop="nickName"
                                     label="昵称"
                                     width="100px">
                    </el-table-column>
                    <el-table-column prop="name"
                                     label="名字">
                    </el-table-column>
                    <el-table-column fixed="right"
                                     label="操作"
                                     width="150px">
                        <template slot-scope="scope">
                            <el-button @click="" type="text" size="small" v-if="checkPermsission('Query')">查看</el-button>
                            <el-button @click="" type="text" size="small" v-if="checkPermsission('Add')">增加</el-button>
                            <el-button @click="" type="text" size="small" v-if="checkPermsission('Update')">编辑</el-button>
                            <el-button @click="" type="text" size="small" v-if="checkPermsission('Delete')">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
            <div>
                <el-pagination @size-change="handleSizeChange"
                               @current-change="handleCurrentChange"
                               :current-page="currentPage"
                               :page-sizes="pageSizes"
                               :page-size="PageSize" layout="total, sizes, prev, pager, next, jumper"
                               :total="totalCount">
                </el-pagination>
            </div>
        </template>
    </div>
    <script>
        axios.defaults.headers.Authorization = JSON.parse(sessionStorage.getItem("Authorization"));
        new Vue({
            el: "#app",
            data: {
                title:'AdminUser',
                tableData: [],
                currentPage: 1,
                totalCount: 1,
                pageSizes: [5, 10, 20, 30,40,50],
                PageSize: 10,
                SysUserReq: {},
                Date: [],
                Status: '1',
                Permissions:[]
            },
            methods: {
                getData: function (n1, n2) {
                    this.SysUserReq = { orgCode: 1, PageSize: n1, currentPage: n2, };
                    axios.post('/admin/user', this.$data).then(response => {
                        if (response.data.code === 1) {
                            console.log(response.data.data);
                            this.tableData = response.data.data.tableData;
                            this.totalCount = response.data.data.totalCount;
                        } else {
                            alert(response.data.message);
                        }
                    }).catch(function (error) {
                        redirect(error);
                    });
                },
                // 每页显示的条数
                handleSizeChange:function(val) {
                    // 改变每页显示的条数 
                    this.PageSize = val;
                    // 点击每页显示的条数时，显示第一页
                    this.getData(val, 1);
                    // 注意：在改变每页显示的条数时，要将页码显示到第一页
                    this.currentPage = 1;
                },
                // 显示第几页
                handleCurrentChange:function(val) {
                    // 改变默认的页数
                    this.currentPage = val;
                    // 切换页码时，要获取每页显示的条数
                    this.getData(this.PageSize, (val) * (this.pageSize));
                },
                checkPermsission(button_name) {
                    for (var i = 0; i < this.Permissions.length; i++) {
                        //console.log((this.title + button_name).toLowerCase());
                        //console.log(this.Permissions[i].toLowerCase());
                        if (this.Permissions[i].toLowerCase() === (this.title + button_name).toLowerCase()) return true;
                    }
                    return (false);
                }
            },
            created: function () {
                this.Permissions = JSON.parse(sessionStorage.getItem(this.title));
                this.getData(this.PageSize, this.currentPage);
                this.Date = [new Date(), new Date()];
            }
        });
    </script>
</body>
</html>